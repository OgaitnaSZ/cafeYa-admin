<div class="space-y-6">
  
  <!-- Header -->
    <div class="flex sm:items-center justify-between gap-4">
    <div>
      <h2 class="text-2xl font-black text-gray-900">Pedidos Activos</h2>
      <p class="text-sm text-gray-500">
        {{ totalActivos() }} pedido{{ totalActivos() !== 1 ? 's' : '' }} en cocina
      </p>
    </div>

    <!-- Actions -->
    <div class="flex items-center gap-2">
      <!-- Refresh -->
      <button
        (click)="recargar()"
        [disabled]="actualizando()"
        class="h-11 px-4 bg-white border-2 border-gray-200 text-gray-700 font-semibold rounded-xl hover:bg-gray-50 disabled:opacity-50 active:scale-95 transition-all flex items-center gap-2 cursor-pointer"
      >
        <lucide-angular [img]="RefreshCw" class="w-4 h-4" [class.animate-spin]="actualizando()"></lucide-angular>
        <span class="hidden sm:inline">Actualizar</span>
      </button>
    </div>

</div>

  <!-- Filtros m√≥viles -->
  <div class="lg:hidden bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
    <div class="flex gap-2 overflow-x-auto">
      <button
        (click)="estadoFiltroMovil.set('todos')"
        class="px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap transition shrink-0"
        [class.bg-orange-500]="estadoFiltroMovil() === 'todos'"
        [class.text-white]="estadoFiltroMovil() === 'todos'"
        [class.shadow-md]="estadoFiltroMovil() === 'todos'"
        [class.bg-gray-100]="estadoFiltroMovil() !== 'todos'"
        [class.text-gray-700]="estadoFiltroMovil() !== 'todos'"
      >
        Todos ({{ totalActivos() }})
      </button>
      <button
        (click)="estadoFiltroMovil.set('Pendiente')"
        class="px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap transition shrink-0"
        [class.bg-yellow-500]="estadoFiltroMovil() === 'Pendiente'"
        [class.text-white]="estadoFiltroMovil() === 'Pendiente'"
        [class.shadow-md]="estadoFiltroMovil() === 'Pendiente'"
        [class.bg-gray-100]="estadoFiltroMovil() !== 'Pendiente'"
        [class.text-gray-700]="estadoFiltroMovil() !== 'Pendiente'"
      >
        Pendientes ({{ pedidosPendientes().length }})
      </button>
      <button
        (click)="estadoFiltroMovil.set('En_preparacion')"
        class="px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap transition shrink-0"
        [class.bg-blue-500]="estadoFiltroMovil() === 'En_preparacion'"
        [class.text-white]="estadoFiltroMovil() === 'En_preparacion'"
        [class.shadow-md]="estadoFiltroMovil() === 'En_preparacion'"
        [class.bg-gray-100]="estadoFiltroMovil() !== 'En_preparacion'"
        [class.text-gray-700]="estadoFiltroMovil() !== 'En_preparacion'"
      >
        En Prep. ({{ pedidosEnPreparacion().length }})
      </button>
      <button
        (click)="estadoFiltroMovil.set('Listo')"
        class="px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap transition shrink-0"
        [class.bg-green-500]="estadoFiltroMovil() === 'Listo'"
        [class.text-white]="estadoFiltroMovil() === 'Listo'"
        [class.shadow-md]="estadoFiltroMovil() === 'Listo'"
        [class.bg-gray-100]="estadoFiltroMovil() !== 'Listo'"
        [class.text-gray-700]="estadoFiltroMovil() !== 'Listo'"
      >
        Listos ({{ pedidosListos().length }})
      </button>
    </div>
  </div>

  <!-- Loading -->
  @if(loadingLista()) {
    <div class="flex justify-center items-center py-20">
      <div class="w-16 h-16 border-4 border-orange-200 border-t-orange-500 rounded-full animate-spin"></div>
    </div>
  }

  <!-- Vista Desktop: Kanban con 3 columnas -->
  @if(!loadingLista()) {
    <div class="hidden lg:block mx-auto p-6">
      <div class="grid grid-cols-3 gap-6">
        
        <!-- Columna: PENDIENTES -->
        <div class="space-y-4">
          <!-- Header columna -->
          <div class="bg-linear-to-r from-yellow-400 to-orange-400 rounded-2xl p-4 shadow-lg">
            <div class="flex items-center justify-between text-white">
              <div class="flex items-center gap-2">
                <lucide-angular [img]="Clock" class="w-5 h-5"></lucide-angular>
                <h3 class="text-lg font-black">PENDIENTES</h3>
              </div>
              <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
                <span class="text-sm font-black">{{ pedidosPendientes().length }}</span>
              </div>
            </div>
          </div>

          <!-- Pedidos pendientes -->
          <div class="space-y-3">
            @if(pedidosPendientes().length === 0) {
              <div class="bg-white rounded-xl p-6 text-center border-2 border-dashed border-gray-200">
                <div class="text-4xl mb-2">‚ú®</div>
                <p class="text-sm text-gray-500 font-medium">Sin pedidos pendientes</p>
              </div>
            }
            @for(pedido of pedidosPendientes(); track pedido.pedido_id) {
              @let urgencia = getColorUrgencia(pedido.created_at);
              
              <div 
                class="bg-white rounded-2xl p-4 shadow-sm border-2 hover:shadow-lg transition-all duration-200 cursor-pointer"
                [class.border-yellow-200]="urgencia === 'normal'"
                [class.border-orange-300]="urgencia === 'warning'"
                [class.border-red-400]="urgencia === 'urgent'"
                [class.animate-pulse]="urgencia === 'urgent'"
              >
                <!-- Header -->
                <div class="flex items-start justify-between mb-3">
                  <div>
                    <div class="flex items-center gap-2 mb-1">
                      <span class="text-2xl font-black text-gray-900">#{{ pedido.numero_pedido.split('-')[1] }}</span>
                      <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-lg text-xs font-bold">
                        Mesa {{ pedido.mesa?.numero || 'N/A' }}
                      </span>
                    </div>
                    <p class="text-xs text-gray-500">{{ formatHora(pedido.created_at) }}</p>
                  </div>
                  
                  <!-- Tiempo transcurrido -->
                  <div 
                    class="px-2 py-1 rounded-lg text-xs font-bold"
                    [class.bg-green-100]="urgencia === 'normal'"
                    [class.text-green-700]="urgencia === 'normal'"
                    [class.bg-orange-100]="urgencia === 'warning'"
                    [class.text-orange-700]="urgencia === 'warning'"
                    [class.bg-red-100]="urgencia === 'urgent'"
                    [class.text-red-700]="urgencia === 'urgent'"
                  >
                    {{ calcularTiempo(pedido.created_at) }}
                  </div>
                </div>

                <!-- Cliente -->
                <div class="mb-3 p-2 bg-gray-50 rounded-lg">
                  <p class="text-xs text-gray-500 mb-1">Cliente</p>
                  <p class="text-sm font-bold text-gray-900">{{ pedido.nombre_cliente }}</p>
                </div>

                <!-- Productos -->
                <div class="mb-3 space-y-2">
                  @for(item of pedido?.productos?.slice(0, 3) ?? []; track item.pedido_producto_id) {
                    <div class="flex items-center gap-2 text-sm">
                      <span class="w-6 h-6 bg-orange-500 text-white rounded-lg flex items-center justify-center text-xs font-bold shrink-0">
                        {{ item.cantidad }}
                      </span>
                      <span class="font-semibold text-gray-900 flex-1">{{ item.producto?.nombre }}</span>
                    </div>
                  }
                  @if((pedido?.productos?.length ?? 0) > 3) {
                    <p class="text-xs text-gray-500 pl-8">+ {{ (pedido?.productos?.length ?? 0) - 3 }} m√°s</p>
                  }
                </div>

                <!-- Nota -->
                @if(pedido.nota) {
                  <div class="mb-3 p-2 bg-amber-50 border border-amber-200 rounded-lg">
                    <p class="text-xs text-amber-900">üí¨ {{ pedido.nota }}</p>
                  </div>
                }

                <!-- Bot√≥n acci√≥n -->
                <button
                  (click)="cambiarEstado(pedido, 'En_preparacion', $event)"
                  class="w-full h-11 bg-linear-to-r from-blue-500 to-indigo-600 text-white rounded-xl hover:shadow-lg hover:shadow-blue-500/50 active:scale-95 transition-all font-bold text-sm"
                >
                  ‚Üí PREPARAR
                </button>
              </div>
            }
          </div>
        </div>

        <!-- Columna: En_preparacion -->
        <div class="space-y-4">
          <!-- Header columna -->
          <div class="bg-linear-to-r from-blue-500 to-indigo-600 rounded-2xl p-4 shadow-lg">
            <div class="flex items-center justify-between text-white">
              <div class="flex items-center gap-2">
                <lucide-angular [img]="Package" class="w-5 h-5"></lucide-angular>
                <h3 class="text-lg font-black">En_preparacion</h3>
              </div>
              <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
                <span class="text-sm font-black">{{ pedidosEnPreparacion().length }}</span>
              </div>
            </div>
          </div>

          <!-- Pedidos En_preparacion -->
          <div class="space-y-3">
            @if(pedidosEnPreparacion().length === 0) {
              <div class="bg-white rounded-xl p-6 text-center border-2 border-dashed border-gray-200">
                <div class="text-4xl mb-2">üë®‚Äçüç≥</div>
                <p class="text-sm text-gray-500 font-medium">Sin pedidos En_preparacion</p>
              </div>
            }
            @for(pedido of pedidosEnPreparacion(); track pedido.pedido_id) {
              @let urgencia = getColorUrgencia(pedido.created_at);
              
              <div 
                class="bg-white rounded-2xl p-4 shadow-sm border-2 hover:shadow-lg transition-all duration-200"
                [class.border-blue-200]="urgencia === 'normal'"
                [class.border-orange-300]="urgencia === 'warning'"
                [class.border-red-400]="urgencia === 'urgent'"
                [class.animate-pulse]="urgencia === 'urgent'"
              >
                <!-- Header -->
                <div class="flex items-start justify-between mb-3">
                  <div>
                    <div class="flex items-center gap-2 mb-1">
                      <span class="text-2xl font-black text-gray-900">#{{ pedido.numero_pedido.split('-')[1] }}</span>
                      <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-lg text-xs font-bold">
                        Mesa {{ pedido.mesa?.numero || 'N/A' }}
                      </span>
                    </div>
                    <p class="text-xs text-gray-500">{{ formatHora(pedido.created_at) }}</p>
                  </div>
                  
                  <!-- Tiempo transcurrido -->
                  <div 
                    class="px-2 py-1 rounded-lg text-xs font-bold"
                    [class.bg-green-100]="urgencia === 'normal'"
                    [class.text-green-700]="urgencia === 'normal'"
                    [class.bg-orange-100]="urgencia === 'warning'"
                    [class.text-orange-700]="urgencia === 'warning'"
                    [class.bg-red-100]="urgencia === 'urgent'"
                    [class.text-red-700]="urgencia === 'urgent'"
                  >
                    {{ calcularTiempo(pedido.created_at) }}
                  </div>
                </div>

                <!-- Cliente -->
                <div class="mb-3 p-2 bg-gray-50 rounded-lg">
                  <p class="text-xs text-gray-500 mb-1">Cliente</p>
                  <p class="text-sm font-bold text-gray-900">{{ pedido.nombre_cliente }}</p>
                </div>

                <!-- Productos -->
                <div class="mb-3 space-y-2">
                  @for(item of pedido?.productos?.slice(0, 3) ?? []; track item.pedido_producto_id) {
                    <div class="flex items-center gap-2 text-sm">
                      <span class="w-6 h-6 bg-orange-500 text-white rounded-lg flex items-center justify-center text-xs font-bold shrink-0">
                        {{ item.cantidad }}
                      </span>
                      <span class="font-semibold text-gray-900 flex-1">{{ item.producto?.nombre }}</span>
                    </div>
                  }
                  @if((pedido?.productos?.length ?? 0) > 3) {
                    <p class="text-xs text-gray-500 pl-8">+ {{ (pedido?.productos?.length ?? 0) - 3 }} m√°s</p>
                  }
                </div>

                <!-- Nota -->
                @if(pedido.nota) {
                  <div class="mb-3 p-2 bg-amber-50 border border-amber-200 rounded-lg">
                    <p class="text-xs text-amber-900">üí¨ {{ pedido.nota }}</p>
                  </div>
                }

                <!-- Bot√≥n acci√≥n -->
                <button
                  (click)="cambiarEstado(pedido, 'Listo', $event)"
                  class="w-full h-11 bg-linear-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:shadow-lg hover:shadow-green-500/50 active:scale-95 transition-all font-bold text-sm"
                >
                  ‚úì MARCAR LISTO
                </button>
              </div>
            }
          </div>
        </div>

        <!-- Columna: LISTOS -->
        <div class="space-y-4">
          <!-- Header columna -->
          <div class="bg-linear-to-r from-green-500 to-emerald-600 rounded-2xl p-4 shadow-lg">
            <div class="flex items-center justify-between text-white">
              <div class="flex items-center gap-2">
                <lucide-angular [img]="CheckCircle" class="w-5 h-5"></lucide-angular>
                <h3 class="text-lg font-black">LISTOS</h3>
              </div>
              <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
                <span class="text-sm font-black">{{ pedidosListos().length }}</span>
              </div>
            </div>
          </div>

          <!-- Pedidos listos -->
          <div class="space-y-3">
            @if(pedidosListos().length === 0) {
              <div class="bg-white rounded-xl p-6 text-center border-2 border-dashed border-gray-200">
                <div class="text-4xl mb-2">üéâ</div>
                <p class="text-sm text-gray-500 font-medium">Sin pedidos listos</p>
              </div>
            }
            @for(pedido of pedidosListos(); track pedido.pedido_id) {
              <div class="bg-white rounded-2xl p-4 shadow-sm border-2 border-green-200 hover:shadow-lg transition-all duration-200">
                <!-- Header -->
                <div class="flex items-start justify-between mb-3">
                  <div>
                    <div class="flex items-center gap-2 mb-1">
                      <span class="text-2xl font-black text-gray-900">#{{ pedido.numero_pedido.split('-')[1] }}</span>
                      <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-lg text-xs font-bold">
                        Mesa {{ pedido.mesa?.numero || 'N/A' }}
                      </span>
                    </div>
                    <p class="text-xs text-gray-500">{{ formatHora(pedido.created_at) }}</p>
                  </div>
                  
                  <div class="px-2 py-1 bg-green-100 text-green-700 rounded-lg text-xs font-bold">
                    {{ calcularTiempo(pedido.created_at) }}
                  </div>
                </div>

                <!-- Cliente -->
                <div class="mb-3 p-2 bg-gray-50 rounded-lg">
                  <p class="text-xs text-gray-500 mb-1">Cliente</p>
                  <p class="text-sm font-bold text-gray-900">{{ pedido.nombre_cliente }}</p>
                </div>

                <!-- Productos -->
                <div class="mb-3 space-y-2">
                  @for(item of pedido?.productos?.slice(0, 3) ?? []; track item.pedido_producto_id) {
                    <div class="flex items-center gap-2 text-sm">
                      <span class="w-6 h-6 bg-orange-500 text-white rounded-lg flex items-center justify-center text-xs font-bold shrink-0">
                        {{ item.cantidad }}
                      </span>
                      <span class="font-semibold text-gray-900 flex-1">{{ item.producto?.nombre }}</span>
                    </div>
                  }
                  @if ((pedido?.productos?.length ?? 0) > 3) {
                    <p class="text-xs text-gray-500 pl-8">+ {{ (pedido?.productos?.length ?? 0) - 3 }} m√°s</p>
                  }
                </div>

                <!-- Bot√≥n acci√≥n -->
                <button
                  (click)="cambiarEstado(pedido, 'Entregado', $event)"
                  class="w-full h-11 bg-linear-to-r from-gray-600 to-gray-800 text-white rounded-xl hover:shadow-lg active:scale-95 transition-all font-bold text-sm"
                >
                  ‚úì ENTREGAR
                </button>
              </div>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Vista M√≥vil: Lista simple -->
    <div class="lg:hidden space-y-3">
      @if(pedidosFiltradosMovil().length === 0) {
        <div class="w-100 bg-white rounded-2xl p-4 text-center border-2 border-dashed border-gray-200">
          <div class="text-5xl mb-3">üì±</div>
          <h3 class="text-lg font-bold text-gray-900 mb-1">Sin pedidos</h3>
          <p class="text-sm text-gray-500">No hay pedidos con este estado</p>
        </div>
      }

      @for(pedido of pedidosFiltradosMovil(); track pedido.pedido_id) {
        @let urgencia = getColorUrgencia(pedido.created_at);
        
        <div 
          class="bg-white rounded-2xl p-4 shadow-sm border-2"
          [class.border-yellow-200]="pedido.estado === 'Pendiente'"
          [class.border-blue-200]="pedido.estado === 'En_preparacion'"
          [class.border-green-200]="pedido.estado === 'Listo'"
          [class.animate-pulse]="urgencia === 'urgent'"
        >
          <!-- Header -->
          <div class="flex items-start justify-between mb-3">
            <div class="flex items-center gap-2">
              <span class="text-3xl font-black text-gray-900">#{{ pedido.numero_pedido.split('-')[1] }}</span>
              <div>
                <span class="block px-2 py-1 bg-blue-100 text-blue-700 rounded-lg text-xs font-bold">
                  Mesa {{ pedido.mesa?.numero || 'N/A' }}
                </span>
                <span class="block text-xs text-gray-500 mt-1">{{ formatHora(pedido.created_at) }}</span>
              </div>
            </div>
            
            <div 
              class="px-3 py-1.5 rounded-lg text-xs font-bold"
              [class.bg-green-100]="urgencia === 'normal'"
              [class.text-green-700]="urgencia === 'normal'"
              [class.bg-orange-100]="urgencia === 'warning'"
              [class.text-orange-700]="urgencia === 'warning'"
              [class.bg-red-100]="urgencia === 'urgent'"
              [class.text-red-700]="urgencia === 'urgent'"
            >
              {{ calcularTiempo(pedido.created_at) }}
            </div>
          </div>

          <!-- Cliente -->
          <div class="mb-3 p-3 bg-gray-50 rounded-xl">
            <p class="text-xs text-gray-500 mb-1">Cliente</p>
            <p class="text-base font-bold text-gray-900">{{ pedido.nombre_cliente }}</p>
          </div>

          <!-- Productos -->
          <div class="mb-3 space-y-2">
            @for(item of pedido.productos; track item.pedido_producto_id) {
              <div class="flex items-center gap-3 p-2 bg-gray-50 rounded-lg">
                <span class="w-8 h-8 bg-orange-500 text-white rounded-lg flex items-center justify-center text-sm font-bold shrink-0">
                  {{ item.cantidad }}
                </span>
                <span class="font-bold text-gray-900 flex-1">{{ item.producto?.nombre }}</span>
              </div>
            }
          </div>

          <!-- Nota -->
          @if(pedido.nota) {
            <div class="mb-3 p-3 bg-amber-50 border border-amber-200 rounded-xl">
              <p class="text-sm text-amber-900">üí¨ {{ pedido.nota }}</p>
            </div>
          }

          <!-- Botones acci√≥n -->
          <div class="flex gap-2">
            @if(pedido.estado === 'Pendiente') {
              <button
                (click)="cambiarEstado(pedido, 'En_preparacion', $event)"
                class="flex-1 h-12 bg-linear-to-r from-blue-500 to-indigo-600 text-white rounded-xl active:scale-95 transition-all font-bold"
              >
                ‚Üí PREPARAR
              </button>
            } @else if(pedido.estado === 'En_preparacion') {
              <button
                (click)="cambiarEstado(pedido, 'Listo', $event)"
                class="flex-1 h-12 bg-linear-to-r from-green-500 to-emerald-600 text-white rounded-xl active:scale-95 transition-all font-bold"
              >
                ‚úì MARCAR LISTO
              </button>
            } @else if(pedido.estado === 'Listo') {
              <button
                (click)="cambiarEstado(pedido, 'Entregado', $event)"
                class="flex-1 h-12 bg-linear-to-r from-gray-600 to-gray-800 text-white rounded-xl active:scale-95 transition-all font-bold"
              >
                ‚úì ENTREGAR
              </button>
            }
          </div>
        </div>
      }
    </div>
  }

</div>