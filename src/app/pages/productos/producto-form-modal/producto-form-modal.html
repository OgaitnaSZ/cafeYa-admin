 <!-- Backdrop -->
    <div
      class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
      (click)="onBackdropClick($event)"
    >
      <!-- Modal -->
      <div
        class="
          bg-white rounded-3xl shadow-2xl
          w-full max-w-2xl
          max-h-[90vh] overflow-y-auto
          animate-slide-up
        "
        (click)="$event.stopPropagation()"
      >
        <!-- Header -->
        <div class="sticky top-0 bg-white border-b border-gray-100 px-6 py-4 flex items-center justify-between z-10">
          <div>
            <h3 class="text-xl font-black text-gray-900">Editar Producto</h3>
            <p class="text-sm text-gray-500">Modificá los datos del producto</p>
          </div>
          <button
            (click)="onClose()"
            class="
              w-9 h-9
              flex items-center justify-center
              rounded-lg
              text-gray-400 hover:text-gray-600 hover:bg-gray-100
              transition
            "
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>

        <!-- Form -->
        <form [formGroup]="form" (ngSubmit)="onSubmit()" class="p-6 space-y-5">
          
          <!-- Imagen actual -->
          @if(producto.imagen_url) {
            <div>
              <p class="text-sm font-semibold text-gray-700 mb-2">Imagen actual</p>
              <div class="w-32 h-32 rounded-xl overflow-hidden bg-gray-100">
                <img
                  [src]="producto.imagen_url"
                  [alt]="producto.nombre"
                  class="w-full h-full object-cover"
                />
              </div>
            </div>
          }

          <!-- URL de imagen -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
              URL de Imagen
            </label>
            <input
              formControlName="imagen_url"
              type="url"
              placeholder="https://ejemplo.com/imagen.jpg"
              class="
                w-full h-11 px-4
                text-sm
                border-2 border-gray-200
                rounded-xl
                focus:border-orange-500 focus:outline-none
                transition
              "
            />
          </div>

          <!-- Nombre -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
              Nombre <span class="text-red-500">*</span>
            </label>
            <input
              formControlName="nombre"
              type="text"
              placeholder="Ej: Cappuccino"
              class="
                w-full h-11 px-4
                text-sm
                border-2 border-gray-200
                rounded-xl
                focus:border-orange-500 focus:outline-none
                transition
              "
              [class.border-red-300]="form.get('nombre')?.invalid && form.get('nombre')?.touched"
            />
          </div>

          <!-- Descripción -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
              Descripción <span class="text-red-500">*</span>
            </label>
            <textarea
              formControlName="descripcion"
              rows="3"
              placeholder="Describe el producto..."
              class="
                w-full px-4 py-3
                text-sm
                border-2 border-gray-200
                rounded-xl
                focus:border-orange-500 focus:outline-none
                transition
                resize-none
              "
              [class.border-red-300]="form.get('descripcion')?.invalid && form.get('descripcion')?.touched"
            ></textarea>
          </div>

          <!-- Grid: Categoría y Precio -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <!-- Categoría -->
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                Categoría <span class="text-red-500">*</span>
              </label>
              <select
                formControlName="categoria_id"
                class="
                  w-full h-11 px-4
                  text-sm
                  border-2 border-gray-200
                  rounded-xl
                  focus:border-orange-500 focus:outline-none
                  transition
                "
              >
                <option [ngValue]="0">Seleccionar categoría</option>
                @for(cat of categorias; track cat.categoria_id) {
                  <option [ngValue]="cat.categoria_id">{{ cat.nombre }}</option>
                }
              </select>
            </div>

            <!-- Precio -->
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                Precio <span class="text-red-500">*</span>
              </label>
              <div class="relative">
                <span class="absolute inset-y-0 left-0 pl-4 flex items-center text-gray-500 text-sm font-semibold">
                  $
                </span>
                <input
                  formControlName="precio_unitario"
                  type="number"
                  min="0"
                  step="100"
                  placeholder="0"
                  class="
                    w-full h-11 pl-8 pr-4
                    text-sm
                    border-2 border-gray-200
                    rounded-xl
                    focus:border-orange-500 focus:outline-none
                    transition
                  "
                  [class.border-red-300]="form.get('precio_unitario')?.invalid && form.get('precio_unitario')?.touched"
                />
              </div>
            </div>
          </div>

          <!-- Error message -->
          @if(error()) {
            <div class="p-3 bg-red-50 border border-red-200 rounded-xl text-sm text-red-700">
              {{ error() }}
            </div>
          }

          <!-- Actions -->
          <div class="flex gap-3 pt-2">
            <button
              type="button"
              (click)="onClose()"
              class="
                flex-1 h-11
                border-2 border-gray-200
                text-gray-700 font-semibold
                rounded-xl
                hover:bg-gray-50
                active:scale-95
                transition-all
              "
            >
              Cancelar
            </button>
            <button
              type="submit"
              [disabled]="form.invalid || saving()"
              class="
                flex-1 h-11
                bg-linear-to-r from-orange-500 to-red-500
                text-white font-bold
                rounded-xl
                shadow-lg shadow-orange-500/20
                disabled:opacity-50 disabled:cursor-not-allowed
                active:scale-95
                transition-all
                flex items-center justify-center gap-2
              "
            >
              @if(saving()) {
                <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                <span>Guardando...</span>
              } @else {
                <span>Guardar Cambios</span>
              }
            </button>
          </div>
        </form>
      </div>
    </div>