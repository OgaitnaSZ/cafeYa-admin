<div
  class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
  (click)="onBackdropClick($event)"
>
  <div
    class="bg-white rounded-3xl shadow-2xl w-full max-w-md animate-slide-up"
    (click)="$event.stopPropagation()"
  >
    <!-- Header -->
    <div class="border-b border-gray-100 px-6 py-4 flex items-center justify-between">
      <div>
        <h3 class="text-xl font-black text-gray-900">{{ modalTitle() }}</h3>
        <p class="text-sm text-gray-500">Configur√° los datos de la mesa</p>
      </div>
      <button
        (click)="onClose()"
        class="w-9 h-9 flex items-center justify-center rounded-lg text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition cursor-pointer"
      >
        <lucide-angular [img]="X" class="w-5 h-5"></lucide-angular>
      </button>
    </div>

    <!-- Form -->
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="p-6 space-y-5">
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">
          N√∫mero de Mesa <span class="text-red-500">*</span>
        </label>
        <input
          formControlName="numero"
          type="number"
          min="1"
          max="30"
          placeholder="Ej: 1, 2, 3..."
          class="
            w-full h-12 px-4 text-base
            border-2 border-gray-200 rounded-xl
            focus:border-orange-500 focus:outline-none
            transition
          "
          [class.border-red-300]="form.get('numero')?.invalid && form.get('numero')?.touched"
        />
        @if(form.get('numero')?.invalid && form.get('numero')?.touched) {
          <p class="text-xs text-red-600 mt-1.5">El n√∫mero es requerido</p>
        }
      </div>

      <!-- Estado (solo en modo editar) -->
      @if(isEditMode()) {
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            Estado actual
          </label>
          <div class="flex gap-3">
            <label class="flex-1 cursor-pointer">
              <input
                type="radio"
                formControlName="estado"
                value="Disponible"
                class="sr-only peer"
              />
              <div class="
                h-11 px-4
                flex items-center justify-center
                border-2 border-gray-200
                rounded-xl gap-1
                text-sm font-semibold
                peer-checked:border-green-500
                peer-checked:bg-green-50
                peer-checked:text-green-700
                transition
              ">
                <lucide-angular [img]="Check" class="w-5 h-5"></lucide-angular>
                Disponible
              </div>
            </label>
            <label class="flex-1 cursor-pointer">
              <input
                type="radio"
                formControlName="estado"
                value="Ocupada"
                class="sr-only peer"
              />
              <div class="
                h-11 px-4 gap-1
                flex items-center justify-center
                border-2 border-gray-200
                rounded-xl
                text-sm font-semibold
                peer-checked:border-orange-500
                peer-checked:bg-orange-50
                peer-checked:text-orange-700
                transition
              ">
                <lucide-angular [img]="LockKeyhole" class="w-5 h-5"></lucide-angular>
                Ocupada
              </div>
            </label>
          </div>
          <p class="text-xs text-gray-500 mt-2">
            üí° Cambiar manualmente el estado. Las sesiones activas lo actualizan autom√°ticamente.
          </p>
        </div>
      }

      <!-- Preview -->
      @if(form.get('numero')?.value) {
        <div class="p-4 bg-linear-to-br from-orange-50 to-amber-50 border-2 border-orange-200 rounded-xl">
          <p class="text-xs text-orange-600 font-semibold mb-2">Vista previa:</p>
          <div class="flex items-center gap-3">
            <div class="w-14 h-14 bg-linear-to-br from-orange-500 to-red-500 text-white rounded-xl flex items-center justify-center font-black text-2xl shadow-lg">
              {{ form.get('numero')?.value }}
            </div>
            <div>
              <p class="text-base font-bold text-gray-900">Mesa {{ form.get('numero')?.value }}</p>
              <p class="text-xs text-gray-600">Estado: {{ form.get('estado')?.value }}</p>
            </div>
          </div>
        </div>
      }

      @if(!isEditMode()) {
        <div class="p-3 bg-blue-50 border border-blue-200 rounded-xl text-sm text-blue-700">
          ‚ÑπÔ∏è Al crear la mesa se generar√° autom√°ticamente un c√≥digo de acceso √∫nico
        </div>
      }

      <!-- Actions -->
      <div class="flex gap-3 pt-2">
        <button
          type="button"
          (click)="onClose()"
          [disabled]="saving()"
          class="
            flex-1 h-11
            border-2 border-gray-200 text-gray-700 font-semibold rounded-xl
            hover:bg-gray-50 disabled:opacity-50
            active:scale-95 transition-all cursor-pointer
          "
        >
          Cancelar
        </button>
        <button
          type="submit"
          [disabled]="form.invalid || saving()"
          class="
            flex-1 h-11
            bg-linear-to-r from-orange-500 to-red-500
            text-white font-bold rounded-xl
            shadow-lg shadow-orange-500/20
            disabled:opacity-50 disabled:cursor-not-allowed
            active:scale-95 transition-all cursor-pointer
            flex items-center justify-center gap-2
          "
        >
          @if(saving()) {
            <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
            <span>Guardando...</span>
          } @else {
            <span>{{ isEditMode() ? 'Guardar Cambios' : 'Crear Mesa' }}</span>
          }
        </button>
      </div>
    </form>
  </div>
</div>