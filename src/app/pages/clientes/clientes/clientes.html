<!-- admin/clientes/clientes.html -->
<div class="space-y-6">

  <!-- Header -->
  <div>
    <h2 class="text-2xl font-black text-gray-900">Clientes</h2>
    <p class="text-sm text-gray-500">
      {{ totalClientes() }} cliente{{ totalClientes() !== 1 ? 's' : '' }} registrado{{ totalClientes() !== 1 ? 's' : '' }}
    </p>
  </div>

  <!-- Stats cards -->
  <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
    <!-- Total Clientes -->
    <div class="bg-white rounded-2xl p-5 shadow-sm border border-gray-100">
      <div class="w-11 h-11 rounded-xl bg-linear-to-br from-purple-500 to-indigo-600 flex items-center justify-center shadow-lg mb-3">
        <lucide-angular [img]="Users" class="w-6 h-6 text-white"></lucide-angular>
      </div>
      <p class="text-2xl font-black text-gray-900 mb-1">{{ totalClientes() }}</p>
      <p class="text-sm font-semibold text-gray-700">Total clientes</p>
    </div>

    <!-- Con Pedidos -->
    <div class="bg-white rounded-2xl p-5 shadow-sm border border-gray-100">
      <div class="w-11 h-11 rounded-xl bg-linear-to-br from-green-500 to-emerald-600 flex items-center justify-center shadow-lg mb-3">
        <lucide-angular [img]="ShoppingBag" class="w-6 h-6 text-white"></lucide-angular>
      </div>
      <p class="text-2xl font-black text-gray-900 mb-1">{{ clientesConPedidos() }}</p>
      <p class="text-sm font-semibold text-gray-700">Con pedidos</p>
    </div>

    <!-- Sin Pedidos -->
    <div class="bg-white rounded-2xl p-5 shadow-sm border border-gray-100">
      <div class="w-11 h-11 rounded-xl bg-linear-to-br from-gray-400 to-gray-600 flex items-center justify-center shadow-lg mb-3">
        <lucide-angular [img]="Users" class="w-6 h-6 text-white"></lucide-angular>
      </div>
      <p class="text-2xl font-black text-gray-900 mb-1">{{ clientesSinPedidos() }}</p>
      <p class="text-sm font-semibold text-gray-700">Sin pedidos</p>
    </div>

    <!-- Total Pedidos -->
    <div class="bg-white rounded-2xl p-5 shadow-sm border border-gray-100">
      <div class="w-11 h-11 rounded-xl bg-linear-to-br from-orange-500 to-red-500 flex items-center justify-center shadow-lg mb-3">
        <lucide-angular [img]="Receipt" class="w-6 h-6 text-white"></lucide-angular>
      </div>
      <p class="text-2xl font-black text-gray-900 mb-1">{{ totalPedidos() }}</p>
      <p class="text-sm font-semibold text-gray-700">Total pedidos</p>
    </div>
  </div>

  <!-- B√∫squeda -->
  <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
    <div class="relative">
      <lucide-angular [img]="Search" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></lucide-angular>
      <input
        type="text"
        [value]="searchTerm()"
        (input)="searchTerm.set($any($event.target).value)"
        placeholder="Buscar por nombre, email o tel√©fono..."
        class="
          w-full h-11 pl-12 pr-4
          text-sm ms-2
          border-2 border-gray-200
          rounded-xl text-gray-500
          focus:border-orange-500 focus:outline-none
          transition
        "
      />
    </div>
  </div>

  <!-- Loading -->
  @if(loadingLista()) {
    <div class="flex justify-center py-12">
      <div class="w-12 h-12 border-4 border-orange-200 border-t-orange-500 rounded-full animate-spin"></div>
    </div>
  }

<!-- Lista de clientes ‚Äî formato tabla -->
  @if(!loadingLista() && clientesFiltrados().length > 0) {
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">

      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="border-b border-gray-100 bg-gray-50/70">
              <th class="text-left text-xs font-bold text-gray-400 uppercase tracking-wide px-5 py-3">Cliente</th>
              <th class="text-left text-xs font-bold text-gray-400 uppercase tracking-wide px-5 py-3">Contacto</th>
              <th class="text-center text-xs font-bold text-gray-400 uppercase tracking-wide px-5 py-3">Sesi√≥n</th>
              <th class="text-center text-xs font-bold text-gray-400 uppercase tracking-wide px-5 py-3">Pedidos</th>
              <th class="text-right text-xs font-bold text-gray-400 uppercase tracking-wide px-5 py-3">Total gastado</th>
              <th class="text-left text-xs font-bold text-gray-400 uppercase tracking-wide px-5 py-3">Registrado</th>
              <th class="text-left text-xs font-bold text-gray-400 uppercase tracking-wide px-5 py-3">Acciones</th>
            </tr>
          </thead>

          <tbody class="divide-y divide-gray-50">
            @for(cliente of clientesFiltrados(); track cliente.cliente_id) {
              <tr class="hover:bg-gray-50/50 transition-colors group">

                <!-- Avatar + nombre -->
                <td class="px-5 py-3.5">
                  <div class="flex items-center gap-3">
                    <div class="w-9 h-9 rounded-xl bg-linear-to-br from-orange-400 to-red-500 flex items-center justify-center text-white text-sm font-black shadow-sm shrink-0">
                      {{ cliente.nombre.charAt(0).toUpperCase() }}
                    </div>
                    <span class="text-sm font-bold text-gray-900 truncate max-w-40">{{ cliente.nombre }}</span>
                  </div>
                </td>

                <!-- Contacto -->
                <td class="px-5 py-3.5">
                  <div class="space-y-0.5">
                    @if(cliente.email) {
                      <div class="flex items-center gap-1.5">
                        <lucide-angular [img]="Mail" class="w-3.5 h-3.5 text-gray-400 shrink-0"></lucide-angular>
                        <span class="text-xs text-gray-600 truncate max-w-44">{{ cliente.email }}</span>
                      </div>
                    }
                    @if(cliente.telefono) {
                      <div class="flex items-center gap-1.5">
                        <lucide-angular [img]="Phone" class="w-3.5 h-3.5 text-gray-400 shrink-0"></lucide-angular>
                        <span class="text-xs text-gray-600">{{ cliente.telefono }}</span>
                      </div>
                    }
                    @if(!cliente.email && !cliente.telefono) {
                      <span class="text-xs text-gray-300">Sin contacto</span>
                    }
                  </div>
                </td>

                <!-- Duraci√≥n sesi√≥n -->
                <td class="px-5 py-3.5 text-center">
                  @if(cliente.duracion_minutos) {
                    <div class="inline-flex items-center gap-1 px-2 py-1 bg-gray-100 rounded-lg">
                      <lucide-angular [img]="Clock" class="w-3 h-3 text-gray-500"></lucide-angular>
                      <span class="text-xs font-semibold text-gray-700">{{ cliente.duracion_minutos }} min</span>
                    </div>
                  } @else {
                    <span class="text-sm text-gray-300">‚Äî</span>
                  }
                </td>

                <!-- Pedidos -->
                <td class="px-5 py-3.5 text-center">
                  @if((cliente._count?.pedidos || 0) > 0) {
                    <span class="inline-flex items-center justify-center min-w-8 h-7 px-2.5 bg-orange-100 text-orange-700 text-xs font-black rounded-lg">
                      {{ cliente._count!.pedidos }}
                    </span>
                  } @else {
                    <span class="text-xs text-gray-400">0</span>
                  }
                </td>

                <!-- Total gastado -->
                <td class="px-5 py-3.5 text-right">
                  @if(cliente.total_gastado) {
                    <span class="text-sm font-black bg-linear-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent">
                      {{ formatCurrency(cliente.total_gastado) }}
                    </span>
                  } @else {
                    <span class="text-sm text-gray-300">‚Äî</span>
                  }
                </td>

                <!-- Fecha registro -->
                <td class="px-5 py-3.5">
                  <span class="text-sm text-gray-500">{{ formatFecha(cliente.created_at) }}</span>
                </td>

                <!-- Acciones -->
                <td class="px-5 py-3.5">
                  <div class="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                    @if((cliente._count?.pedidos || 0) > 0) {
                      <button (click)="verPedidos(cliente)"
                        class="h-8 px-3 bg-linear-to-r from-orange-500 to-red-500 text-white rounded-lg hover:opacity-90 active:scale-95 transition-all flex items-center gap-1.5 text-xs font-bold cursor-pointer whitespace-nowrap shadow-sm shadow-orange-500/20">
                        <lucide-angular [img]="ShoppingBag" class="w-3.5 h-3.5"></lucide-angular>
                        Ver pedidos
                      </button>
                    }
                    @if((cliente._count?.pedidos || 0) === 0) {
                      <button (click)="openDeleteModal(cliente, $event)"
                        class="h-8 px-3 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 active:scale-95 transition-all flex items-center gap-1.5 text-xs font-semibold cursor-pointer whitespace-nowrap">
                        <lucide-angular [img]="Trash2" class="w-3.5 h-3.5"></lucide-angular>
                        Eliminar
                      </button>
                    }
                  </div>
                </td>

              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  }

  <!-- Estado vac√≠o -->
  @if(!loadingLista() && clientesFiltrados().length === 0) {
    <div class="text-center py-16 bg-white rounded-2xl border-2 border-dashed border-gray-200">
      <div class="text-6xl mb-4">üë•</div>
      <h3 class="text-lg font-semibold text-gray-900 mb-2">
        @if(searchTerm()) {
          No se encontraron clientes
        } @else {
          No hay clientes registrados
        }
      </h3>
      <p class="text-gray-600">
        @if(searchTerm()) {
          Intent√° con otro t√©rmino de b√∫squeda
        } @else {
          Los clientes aparecer√°n aqu√≠ cuando se registren
        }
      </p>
    </div>
  }

</div>

<!-- Modal Eliminar -->
@if(showDeleteModal() && selectedCliente()) {
  <app-confirm-modal
    title="Eliminar Cliente"
    [message]="'¬øEst√°s seguro de eliminar al cliente &quot;' + selectedCliente()!.nombre + '&quot;?<br/><br/>' +
               (selectedCliente()!.email ? '<strong>Email:</strong> ' + selectedCliente()!.email + '<br/>' : '') +
               (selectedCliente()!.telefono ? '<strong>Tel√©fono:</strong> ' + selectedCliente()!.telefono + '<br/><br/>' : '<br/>') +
               'Esta acci√≥n no se puede deshacer.'"
    confirmText="Eliminar"
    confirmClass="bg-red-500 hover:bg-red-600"
    (confirm)="handleDeleteConfirmed()"
    (cancel)="closeDeleteModal()"
  />
}